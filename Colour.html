<!DOCTYPE html>
<html>
<head>
  <title>Color Prediction Game with TON Wallet</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f5f5f5;
      text-align: center;
      padding: 20px;
      max-width: 400px;
      margin: 0 auto;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .tab-buttons {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tab-btn {
      background: #ecf0f1;
      color: #7f8c8d;
      border-radius: 8px 8px 0 0;
      margin: 0 5px;
      padding: 8px 12px;
      font-size: 14px;
    }
    .tab-btn.active {
      background: white;
      color: #3498db;
      font-weight: bold;
    }
    .tab {
      display: none;
    }
    .tab.active {
      display: block;
    }
    input {
      padding: 8px;
      margin: 5px;
      width: 80%;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .deposit-btn {
      background: #2ecc71;
      color: white;
    }
    .withdraw-btn {
      background: #e74c3c;
      color: white;
    }
    #gameRedBtn { background: #e74c3c; color: white; }
    #gameGreenBtn { background: #2ecc71; color: white; }
    .bet-btn { background: #3498db; color: white; }
    .bet-btn.active {
      background: #2980b9;
      box-shadow: 0 0 0 2px white, 0 0 0 4px #3498db;
    }
    .timer {
      font-size: 28px;
      font-weight: bold;
      color: #e74c3c;
      margin: 15px 0;
    }
    .win-message {
      color: #2ecc71;
      font-weight: bold;
    }
    .lose-message {
      color: #e74c3c;
    }
    #pendingWithdrawals {
      margin-top: 20px;
      text-align: left;
      border-top: 1px solid #eee;
      padding-top: 10px;
    }
    .user-dashboard {
      text-align: left;
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 10px;
      vertical-align: middle;
    }
    .user-info {
      display: inline-block;
      vertical-align: middle;
    }
    .user-name {
      font-weight: bold;
      font-size: 16px;
    }
    .user-id {
      color: #7f8c8d;
      font-size: 14px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    .stat-card {
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
    }
    .stat-label {
      font-size: 12px;
      color: #7f8c8d;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- User Dashboard Section -->
    <div class="user-dashboard" id="userDashboard">
      <img src="" alt="Avatar" class="user-avatar" id="userAvatar">
      <div class="user-info">
        <div class="user-name" id="userName">Loading...</div>
        <div class="user-id" id="userId">ID: --</div>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="userBalance">0</div>
          <div class="stat-label">Coins</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="userWins">0</div>
          <div class="stat-label">Wins</div>
        </div>
      </div>
    </div>

    <div class="tab-buttons">
      <button class="tab-btn active" onclick="openTab('game')">ðŸŽ® Game</button>
      <button class="tab-btn" onclick="openTab('wallet')">ðŸ’° Wallet</button>
      <button class="tab-btn" onclick="openTab('history')">ðŸ“œ History</button>
      <button class="tab-btn" onclick="openTab('admin')" id="adminTabBtn" style="display:none;">ðŸ”§ Admin</button>
    </div>
    
    <!-- Game Tab -->
    <div id="gameTab" class="tab active">
      <h1>ðŸŽ¯ Color Prediction</h1>
      
      <div class="timer" id="gameTimer">60</div>
      
      <div id="gameStats">
        <div>Red Bets: <span id="redBets">0</span> coins</div>
        <div>Green Bets: <span id="greenBets">0</span> coins</div>
      </div>
      
      <div>
        <button id="gameRedBtn" onclick="placeBet('red')">RED</button>
        <button id="gameGreenBtn" onclick="placeBet('green')">GREEN</button>
      </div>
      
      <h3>Bet Amount:</h3>
      <div>
        <button class="bet-btn" onclick="setBet(1)">1</button>
        <button class="bet-btn" onclick="setBet(5)">5</button>
        <button class="bet-btn" onclick="setBet(10)">10</button>
        <button class="bet-btn" onclick="setBet(20)">20</button>
      </div>
      
      <div id="gameResult"></div>
    </div>
    
    <!-- Wallet Tab -->
    <div id="walletTab" class="tab">
      <h1>ðŸ’° Wallet</h1>
      <p>Your coins: <span id="walletBalance">0</span></p>
      <p>â‰ˆ <span id="usdtValue">0</span> USDT (1.5x value)</p>
      
      <h3>Deposit USDT</h3>
      <p>Rate: 1 USDT = 10 coins</p>
      <input type="number" id="depositAmount" placeholder="USDT Amount" min="1">
      <button class="deposit-btn" onclick="showDepositAddress()">Get Deposit Address</button>
      <div id="depositAddress" style="margin-top: 10px; word-break: break-all;"></div>
      
      <h3>Withdraw USDT</h3>
      <input type="text" id="withdrawAddress" placeholder="Your USDT Wallet Address">
      <input type="number" id="withdrawAmount" placeholder="Coin Amount" min="10">
      <button class="withdraw-btn" onclick="requestWithdrawal()">Request Withdrawal</button>
      <div id="withdrawResult"></div>
    </div>
    
    <!-- History Tab -->
    <div id="historyTab" class="tab">
      <h1>ðŸ“œ Game History</h1>
      <div id="gameHistory">
        <p>Your recent games will appear here</p>
      </div>
    </div>
    
    <!-- Admin Tab -->
    <div id="adminTab" class="tab">
      <h1>ðŸ”§ Admin Panel</h1>
      <div id="pendingWithdrawals">
        <h3>Pending Withdrawals</h3>
        <div id="withdrawalRequests"></div>
      </div>
      <div style="margin-top: 20px;">
        <h3>Recent Deposits</h3>
        <div id="depositHistory"></div>
      </div>
    </div>
  </div>

  <script>
    // =====================
    // Game Configuration
    // =====================
    const COIN_RATE = 10; // 1 USDT = 10 coins
    const WITHDRAW_RATE = 0.6667; // 1 coin = 0.06667 USDT (1.5x margin)
    const ADMIN_WALLET = "YOUR_TONKEEPER_USDT_ADDRESS"; // Replace with your address
    const ADMIN_USER_ID = "123456789"; // Replace with your Telegram user ID
    
    // =====================
    // Game State
    // =====================
    let coins = 0;
    let currentBet = 0;
    let timer = 60;
    let gameActive = false;
    let countdownInterval;
    let bets = { red: 0, green: 0 };
    let selectedBetBtn = null;
    let userBetColor = null;
    let withdrawalRequests = [];
    let gameHistory = [];
    let depositHistory = [];
    let isAdmin = false;
    let tgUser = null;
    let userWins = 0;
    
    // =====================
    // DOM Elements
    // =====================
    const gameBalanceEl = document.getElementById("gameBalance");
    const walletBalanceEl = document.getElementById("walletBalance");
    const usdtValueEl = document.getElementById("usdtValue");
    const gameTimerEl = document.getElementById("gameTimer");
    const gameResultEl = document.getElementById("gameResult");
    const redBetsEl = document.getElementById("redBets");
    const greenBetsEl = document.getElementById("greenBets");
    const depositAddressEl = document.getElementById("depositAddress");
    const withdrawResultEl = document.getElementById("withdrawResult");
    const withdrawalRequestsEl = document.getElementById("withdrawalRequests");
    const gameHistoryEl = document.getElementById("gameHistory");
    const depositHistoryEl = document.getElementById("depositHistory");
    const userAvatarEl = document.getElementById("userAvatar");
    const userNameEl = document.getElementById("userName");
    const userIdEl = document.getElementById("userId");
    const userBalanceEl = document.getElementById("userBalance");
    const userWinsEl = document.getElementById("userWins");
    const adminTabBtn = document.getElementById("adminTabBtn");
    
    // =====================
    // Telegram WebApp Integration
    // =====================
    function initTelegramUser() {
      // Check if running in Telegram WebApp
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        
        tgUser = Telegram.WebApp.initDataUnsafe.user;
        
        if (tgUser) {
          // Display user info
          userNameEl.textContent = `${tgUser.first_name || ''} ${tgUser.last_name || ''}`.trim() || tgUser.username || 'Telegram User';
          userIdEl.textContent = `ID: ${tgUser.id}`;
          userAvatarEl.src = tgUser.photo_url || 'https://i.imgur.com/3QXZQ2u.png';
          
          // Check if admin
          if (tgUser.id.toString() === ADMIN_USER_ID) {
            isAdmin = true;
            adminTabBtn.style.display = 'inline-block';
          }
        }
      } else {
        // Fallback for testing outside Telegram
        tgUser = {
          id: "123456789",
          first_name: "Test",
          last_name: "User",
          username: "testuser",
          photo_url: "https://i.imgur.com/3QXZQ2u.png"
        };
        userNameEl.textContent = "Test User";
        userIdEl.textContent = "ID: 123456789";
        userAvatarEl.src = tgUser.photo_url;
        
        // Enable admin for testing
        isAdmin = true;
        adminTabBtn.style.display = 'inline-block';
      }
    }
    
    // =====================
    // Core Functions
    // =====================
    function openTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector
